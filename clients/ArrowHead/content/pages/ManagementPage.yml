name: 'Agent Workbooks'
description: 'Shows a list of all policies'
content:
    -
        type: List
        content:
            route: 'file'
            filterable: true
            autoRefresh: 10000
            defaultFilters: 
                sort:
                    -
                        field: date_created
                        dir: desc          
            resizable: true
            pageable:
                buttonCount: 3
                pageSizes:
                    - 10
                    - 20
                    - 50
                info: true
            sortable: 
                allowUnsort: true
                mode: single
            actions:
                -
                    name: Edit
                    rule: 'row.status == "In Progress" || row.status == "Review" || (profile.privileges.MANAGE_POLICY_APPLICATION_CREATE == true && row.status == "Generated")'
                    details:
                        -
                            type: Form
                            form_id: 280dbc6d-638e-4fba-9095-8430c226ec7b
                            fileId: '{{uuid}}'
                    icon: 'far fa-pencil-alt'
                -
                    name: Claims
                    rule: 'profile.privileges.MANAGE_POLICY_APPLICATION_CREATE == true && row.status == "Generated"'
                    details:
                        -
                            type: Document
                            content: '  {
                                <h5 className="totalClaimsAmount">
                                  Total Claims Paid Amount: ${sumTotal > 0 ?  sumTotal : 0}
                                </h5>
                              }'
                            params:
                                sumTotal: 'data.reduce((a, b) => (a ? a : 0) + (b.total ? b.total : 0),0)'
                            url: 'file?filter=[{%22sort%22:[{%22field%22:%22date_created%22,%22dir%22:%22desc%22}],%22filter%22:{%22logic%22:%22and%22,%22filters%22:[{%22field%22:%22childFile%22,%22operator%22:%22eq%22,%22value%22:%221%22}]}}]'
                        -
                            type: List
                            content:
                                route: 'file'
                                defaultFilters:
                                    skip: 0
                                    take: 100
                                    sort:
                                        -
                                            field: date_created
                                            dir: desc
                                    filter:
                                        logic: and
                                        filters:
                                            - 
                                                field: childFile
                                                operator: eq
                                                value: '1'
                                filterable: false           
                                resizable: true
                                sortable: 
                                    allowUnsort: true
                                    mode: single
                                gridToolbar: '<h5> {data.namedInsured} - Claims Summary</h5>'
                                wrapStyle:
                                    height: "90%"
                                operations:
                                    title: "Add New Claim"
                                    actions:
                                        -
                                            name: Add New Claim
                                            rule: "true"
                                            details:
                                                -
                                                    type: Form
                                                    form_id: 055cdece-c75c-4d33-b32c-800e05421406
                                                    parentFileId: '{{uuid}}'      
                                actions:
                                     -
                                         name: Edit
                                         rule: "true"
                                         details:
                                             -
                                                type: Form
                                                form_id: 055cdece-c75c-4d33-b32c-800e05421406
                                                fileId: '{{uuid}}'
                                         icon: 'far fa-pencil-alt'
                                columnConfig:
                                    -
                                        title: Value Date
                                        field: valueDate
                                        cell: '<td>{formatDate(item.valueDate)}</td>'
                                        filter: date
                                        filterFormat: YYYY-MM-DD
                                    -
                                        title: Loss Date
                                        field: lossDate
                                        cell: '<td>{formatDate(item.lossDate)}</td>'
                                        filter: date
                                        filterFormat: YYYY-MM-DD
                                    -
                                        title: "Paid Amount"
                                        field: paid
                                        filter: numeric
                                    - 
                                        title: "Reserve Amount"
                                        field: reserve
                                        filter: numeric
                                    - 
                                        title: Total Amount
                                        field: total
                                        filter: numeric
                                    - 
                                        title: Level 1
                                        field: claimlevel1
                                        filterCell:
                                            type: dropdown
                                            listItems:
                                                - "EPL"
                                                - "Crime"
                                                - "DOL - non-accident"
                                                - "Auto Accident- Owned Auto"
                                                - "Sales Practice"
                                                - "Garagekeepers"
                                                - "Products Liability"
                                                - "Other General Liability"
                                                - "Property"
                                            placeholder: 'Select Level'
                                    - 
                                        title: Carrier
                                        field: carrier
                    icon: 'far fa-hand-holding-usd'
                -
                    name: 'Retry'
                    rule: '(row.status == "Processing" && row.submissionTime) ? moment().isAfter(moment(row.submissionTime).add(3,"m")) : false'
                    icon: 'far fa-redo'
                    updateOnly : true
                    details:
                        -
                            type: Update
                            params:
                                url: 'command/delegate/RetryDocumentGeneration'
                                successNotification: "Regenerating Documents. This might take several minutes."
                -
                    name: 'Export'
                    rule: '''{{status}}'' == ''Generated'''
                    icon: 'far fa-file-download'
                    details:
                        -
                            type: Document
                            content: '<h5>Producer Name: {data.producername} | Insured Name: {data.namedInsured}</h5>'
                            useRowData: true
                        -
                            type: DocumentViewer
                            url: 'file/{{uuid}}/document'
                -
                    name: 'Please Wait'
                    rule: '(row.status == "Processing" && row.submissionTime) ? moment().isBefore(moment(row.submissionTime).add(3,"m")) : false'
                    icon: 'fad fa-circle-notch fa-spin'
            toolbarTemplate: '<h5>List of workbooks</h5>'
            operations:
                title: "Create Workbook"
                actions:
                    -
                        name: Create New Workbook
                        rule: "profile.privileges.MANAGE_POLICY_APPLICATION_CREATE ==true"
                        details:
                            -
                                type: Form
                                form_id: 280dbc6d-638e-4fba-9095-8430c226ec7b      
            columnConfig:
                -
                    title: Insured
                    field: namedInsured
                -
                    title: 'Producer'
                    field: producername
                -
                    title: 'Producer Date'
                    field: producerdate
                    cell: '<td>{formatDate(item.producerdate)}</td>'
                    filter: date
                    filterFormat: YYYY-MM-DD
                -
                    title: 'Effective Date'
                    field: effectiveDate
                    cell: '<td>{formatDate(item.effectiveDate)}</td>'
                    filter: date
                    filterFormat: YYYY-MM-DD
                -
                    title: 'Status'
                    field: status
                    filterCell:
                        type: dropdown
                        listItems:
                            - 'Generated'
                            - 'Review'
                            - 'Processing'
                            - 'In Progress'
                        placeholder: 'Select Status'
                    cell: '{item.status == "Processing" && item.submissionTime ? (
                            moment().isAfter(moment(item.submissionTime).add(3, "m")) ? (
                                <td className="policyStatusFailed"> Error Processing - Please Retry </td>
                            ) : <td> {
                                item.status +
                                " (" +
                                (item.documentsSelectedCount - item.documentsToBeGenerated + 1) +
                                " of " +
                                item.documentsSelectedCount +
                                ")"
                                }</td>
                            ) : item.status == "Review" ? (
                            <td className="policyStatusReview"> Submitted - Under Review </td>
                            ) : (
                            <td>{item.status}</td>
                            )}'